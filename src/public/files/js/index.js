var malasPalabras = [
  "abanto",
  "abrazafarolas",
  "adufe",
  "afloja",
  "alcornoque",
  "alfeñíque",
  "anal",
  "andurriasmo",
  "argentuzo",
  "argentuso",
  "argentucho",
  "arrastracueros",
  "Arse",
  "Arsehole",
  "arseholes",
  "artabán",
  "artaban",
  "ass",
  "asshole",
  "assholes",
  "auschwitz",
  "ausschwitz",
  "aguebonado",
  "aguebonada",
  "agüevonado",
  "agüevonada",
  "asco",
  "asqueroso",
  "asquerosa",
  "aweonado",
  "aweonada",
  "awebonado",
  "awebonada",
  "awevonado",
  "awevonada",
  "baboso",
  "babosa",
  "babosadas",
  "basura",
  "Bellaco",
  "bitch",
  "bizcocho",
  "blow",
  "Blowjob",
  "Bollocks",
  "bolú",
  "bolu",
  "boludo",
  "b0ludo",
  "bolud0",
  "b0lud0",
  "boluda",
  "b0luda",
  "boobs",
  "bufarron",
  "bufarrón",
  "bujarron",
  "bujarrón",
  "buey",
  "Bullshit",
  "buttfuck",
  "buttfucker",
  "cabilla",
  "cabron",
  "cabrón",
  "cabrona",
  "caca",
  "Cachapera",
  "cagalera",
  "cagar",
  "caga",
  "cagante",
  "cagarla",
  "cagaste",
  "cagaste",
  "cagón",
  "cagon",
  "cagona",
  "cancer",
  "cáncer",
  "Carado",
  "caramonda",
  "caramono",
  "caremono",
  "caramondá",
  "caraculo",
  "careculo",
  "carepito",
  "carapito",
  "carapendejo",
  "carependejo",
  "castra",
  "castroso",
  "castrosa",
  "castrante",
  "chacha",
  "chachar",
  "chichar",
  "chichis",
  "chilote",
  "chinga",
  "chinga tu madre",
  "chingadera",
  "chingada",
  "chingado",
  "chíngate",
  "chingate",
  "chingar",
  "chingas",
  "chingaste",
  "chingo",
  "chingon",
  "chingón",
  "chingona",
  "chingues",
  "chinguisa",
  "chinguiza",
  "Chink",
  "Chinky",
  "chiquitingo",
  "chocha",
  "chój",
  "chucha",
  "chuchamadre",
  "chuj",
  "chupalo",
  "chúpalo",
  "chúpala",
  "chupala",
  "chwdp",
  "cipa",
  "cipo",
  "cochon",
  "cochón",
  "cock",
  "Cock",
  "Cocks",
  "Cocksucker",
  "cogas",
  "cojas",
  "coger",
  "cojete",
  "cojón",
  "cojon",
  "cochar",
  "coshar",
  "cocho",
  "comecaca",
  "comepollas",
  "comepoyas",
  "coñazo",
  "coñaso",
  "concha",
  "conchatumadre",
  "conchadetumadre",
  "conxetumare",
  "conxetumadre",
  "conxatumare",
  "conxatumadre",
  "conchetumare",
  "conchatumare",
  "coño",
  "creido",
  "creído",
  "creida",
  "creída",
  "cuca",
  "cueco",
  "Cul",
  "culea",
  "culear",
  "culera",
  "culero",
  "culiado",
  "culiada",
  "culiao",
  "culia",
  "culiad@",
  "culo",
  "Culo",
  "Cum",
  "Cunt",
  "cunts",
  "ctm",
  "csm",
  "Dick",
  "Dickhead",
  "Dicks",
  "encabrona",
  "encabronado",
  "encabronada",
  "emputar",
  "enputar",
  "emputo",
  "enputo",
  "empute",
  "emputado",
  "emputada",
  "enputado",
  "enputada",
  "encular",
  "Enculé",
  "enculer",
  "encula",
  "enculada",
  "enculado",
  "enculo",
  "estupido",
  "estúpido",
  "estupida",
  "estúpida",
  "Faggot",
  "falkland",
  "falklands",
  "fucklands",
  "fuckland",
  "falangista",
  "fascista",
  "Fellatio",
  "fick",
  "fistfuck",
  "follada",
  "follar",
  "follo",
  "follón",
  "follon",
  "Fook",
  "Fooker",
  "Fooking",
  "Fotze",
  "follada",
  "foyada",
  "frei",
  "frijolero",
  "Fuck",
  "Fucker",
  "Fuckers",
  "Fucking",
  "Führer",
  "garcha",
  "gilipolla",
  "guatepeor",
  "jilipolla",
  "gachupín",
  "gachupin",
  "gilipoya",
  "jilipoya",
  "gonorrea",
  "guevon",
  "guevón",
  "guevona",
  "guey",
  "heil",
  "hideputa",
  "hijodeputa",
  "hijoputa",
  "hdp",
  "hitler",
  "Hitler",
  "hueva",
  "huevon",
  "huevón",
  "huevona",
  "HWDP",
  "idiota",
  "imbécil",
  "imbecil",
  "jalabola",
  "Japseye",
  "jeba&H107",
  "jebanie",
  "jebca",
  "jilipollas",
  "Jizz",
  "job",
  "jodan",
  "jodas",
  "jodaz",
  "joder",
  "jodido",
  "jodida",
  "joto",
  "joyo",
  "judenmutter",
  "judensöhne",
  "kaka",
  "caka",
  "kaca",
  "kabron",
  "kabrón",
  "kabrona",
  "Kike",
  "korwa",
  "kórwa",
  "kurwa",
  "kurwia",
  "kutas",
  "leck",
  "leche",
  "lexe",
  "m4nco",
  "macht",
  "malnacida",
  "Malnacido",
  "malparida",
  "malparido",
  "Malvinas",
  "mamada",
  "mamadas",
  "mamado",
  "mamalo",
  "mámalo",
  "mamarla",
  "mamaste",
  "mames",
  "mamón",
  "mamon",
  "mamona",
  "manco",
  "manko",
  "manca",
  "maraca",
  "Marica",
  "marico",
  "Maricon",
  "Maricón",
  "maricones",
  "maricona",
  "mariconas",
  "mariconson",
  "mariconsón",
  "mariconzón",
  "mariconzon",
  "mariqueta",
  "mariquis",
  "mayate",
  "meco",
  "mecos",
  "melgambrea",
  "merde",
  "mexicaca",
  "mejicaca",
  "mexicoño",
  "mejicoño",
  "mejicaño",
  "mexicaño",
  "mich",
  "mierda",
  "m1erda",
  "mierdero",
  "mondá",
  "monda",
  "Mong",
  "moraco",
  "motherfucker",
  "Motherfucking",
  "Nazi",
  "neger",
  "negrata",
  "Nègre",
  "negrero",
  "nekrofil",
  "Nigga",
  "Nigger",
  "niggers",
  "Niquer",
  "no mames",
  "odbyt",
  "odjeba&H142o",
  "ojete",
  "ogete",
  "pajear",
  "pajote",
  "Paki",
  "pakis",
  "panocha",
  "Paragua",
  "payaso",
  "payasa",
  "pecheche",
  "peda",
  "pederasta",
  "pedo",
  "pedota",
  "pedota",
  "pedofila",
  "pedófila",
  "pedofilo",
  "pedófilo",
  "pedón",
  "pendeja",
  "pendejear",
  "pendejo",
  "pendejos",
  "pendejas",
  "pelotudo",
  "pel0tud0",
  "pelotuda",
  "pel0tuda",
  "pene",
  "percanta",
  "perra",
  "Perucho",
  "pete",
  "pierdol",
  "pierdolic",
  "pierdolona",
  "Pinacate",
  "pinche",
  "pinches",
  "pinga",
  "pirobo",
  "pito",
  "pitudo",
  "pizda",
  "polla",
  "porno",
  "poronga",
  "poya",
  "Prick",
  "Pricks",
  "prostiputo",
  "prostiputa",
  "prostituir",
  "prostituta",
  "prostituto",
  "proxeneta",
  "pt",
  "pucha",
  "Puñeta",
  "Pussy",
  "puta",
  "Putain",
  "Putaso",
  "Putazo",
  "pute",
  "Pute",
  "Putete",
  "putillo",
  "putiyo",
  "putito",
  "putita",
  "putitos",
  "putitas",
  "Putiza",
  "puto",
  "putos",
  "putón",
  "ql",
  "qli40",
  "qliao",
  "qli4o",
  "qlia0",
  "qliaos",
  "qli40s",
  "qli4os",
  "qlia0s",
  "Queer",
  "raghead",
  "ragheads",
  "rallig",
  "ramera",
  "rape",
  "reculia",
  "reculiao",
  "retardado",
  "retrasado",
  "retrazado",
  "renob",
  "reql",
  "rentafuck",
  "rimjob",
  "rimming",
  "rozpierdala&H107",
  "rozpierdolone",
  "rozpierdolony",
  "rucha&H107",
  "ruchanie",
  "ruha&H107",
  "ruski",
  "ruskoff",
  "ruskov",
  "s-c-v-m",
  "s.hit",
  "s&m",
  "s1ut",
  "sackgesicht",
  "sado-masochistic",
  "sadomaso",
  "sadomasochistic",
  "sadomasoquismo",
  "sadomasoquista",
  "salame",
  "salvatrucha",
  "salvatrusha",
  "salbatrucha",
  "salbatrusha",
  "samckdaddy",
  "sandm",
  "sandnigger",
  "sangron",
  "sangrón",
  "sangrona",
  "sangrones",
  "sangronas",
  "sarasa",
  "sarracena",
  "sarraceno",
  "satan",
  "satán",
  "satánico",
  "satanico",
  "sausagejockey",
  "sc*m",
  "scat",
  "schamhaar",
  "scheiss",
  "schlampe",
  "schleu",
  "schleuh",
  "schlitzauge",
  "schlong",
  "schutzstaffel",
  "schwanz",
  "schwuchtel",
  "scrote",
  "scum",
  "scum!",
  "sh!t",
  "sh!te",
  "sh!tes",
  "sh1't",
  "sh1t",
  "sh1te",
  "sh1thead",
  "sh1theads",
  "shadybackroomdealings",
  "shadydealings",
  "shag",
  "shaggers",
  "shaggin",
  "shagging",
  "shat",
  "shawtypimp",
  "sheep-l0ver",
  "sheep-l0vers",
  "sheep-lover",
  "sheep-lovers",
  "sheep-shaggers",
  "sheepl0ver",
  "sheepl0vers",
  "sheeplover",
  "sheepshaggers",
  "sheethead",
  "sheetheads",
  "sheister",
  "shhit",
  "shit",
  "shít",
  "shit4brains",
  "shitass",
  "shitbag",
  "shitbagger",
  "shitbrains",
  "shitbreath",
  "shitcunt",
  "shitdick",
  "shiteater",
  "shited",
  "shitface",
  "shitfaced",
  "shitforbrains",
  "shitfuck",
  "shitfucker",
  "shitfull",
  "shithapens",
  "shithappens",
  "shithead",
  "shithole",
  "shithouse",
  "shiting",
  "shitings",
  "shitoutofluck",
  "shits",
  "shitspitter",
  "shitstabber",
  "shitstabbers",
  "shitstain",
  "shitted",
  "shitter",
  "shitters",
  "shittiest",
  "shitting",
  "shittings",
  "shitty",
  "shiz",
  "shiznit",
  "shortfuck",
  "shortfuck",
  "shyte",
  "sida",
  "s1da",
  "sidoso",
  "s1doso",
  "slag",
  "slanderyou2.blogspot.com",
  "slanteye",
  "slut",
  "slutbag",
  "sluts",
  "slutt",
  "slutting",
  "slutty",
  "slutwear",
  "slutwhore",
  "slutwhore",
  "smackdaddy",
  "smackthemonkey",
  "smagma",
  "smartass",
  "smeg",
  "snortingcoke",
  "sonofabitch",
  "sorete",
  "sonofbitch",
  "soplapollas",
  "soplapoyas",
  "Spacka",
  "Spast",
  "Spasten",
  "Spasti",
  "Spaz",
  "Spunk",
  "Spunkbubble",
  "sranie",
  "subnormal",
  "sucker",
  "sudaca",
  "sudaka",
  "tarado",
  "tarada",
  "tarados",
  "taradas",
  "tarugo",
  "tetas",
  "tetona",
  "tolete",
  "tortillera",
  "tortiyera",
  "torpe",
  "traga",
  "Tranny",
  "Twat",
  "verga",
  "vergasen",
  "vergón",
  "vergon",
  "violar",
  "Violer",
  "Wank",
  "Wanker",
  "weon",
  "weona",
  "wey",
  "wn",
  "wehon",
  "wheon",
  "weohn",
  "weonh",
  "w3on",
  "wetback",
  "wyjeb&H107",
  "wyjebac",
  "wyjebany",
  "wypierdol",
  "xuxa",
  "xuxas",
  "Yoruga",
  "zajeba&H107",
  "zajebane",
  "zajebany",
  "zemen",
  "zooplapollas",
  "zoplapollas",
  "zorra",
  "zorriputa",
  "zudaca",
  "zudaka",
];

window.onload = (e) => {
  mainFunction(4000);
};

var socket = io();

socket.emit("userInformation", "hola mundo");

function mainFunction(time) {
  socket.on("connected", function (data) {
    console.log("conectado");
  });

  socket.on("send", function (data) {
    /* $('.tableID').append(`<tr class="contentTable">
        <td class="tableSpace">${data.date}</td>
        <td class="tableSpace">${data.message}</td>
    </tr>`);*/
    if (data.estado === "conectado") {
      document.getElementById(data.identificador).style.backgroundColor =
        "green";
    } else {
      document.getElementById(data.identificador).style.backgroundColor = "red";
      document.getElementById("notificacion").style.display = "block";
      document.getElementById("notificacion").innerHTML +=
        "<p id='name' style='background-color:orange; color: white; font-size: xx-large; text-align:center;'>" +
        "Se ha desconectado el dispositivo " +
        data.identificador +
        "</p>";
      window.setTimeout(function () {
        document.getElementById("notificacion").style.display = "none";
        document.getElementById("name").remove();
      }, 2000);
    }
  });

  socket.on("send2", function (data) {
    console.log("GET /Publicacion", data.corre);
    $(".tableID tr:first").after(`
      
      <tr class="contentTable">
      <td class="tableSpace">${data.correo}</td>
      <td class="tableSpace"><a data-toggle="modal" data-target="#modalMessage${data._id}" style="color: black;"><u>${data.identificador}</u>
          </a></td>
  </tr>
  <div class="modal fade" id="modalMessage${data._id}" tabindex="-1" role="dialog" aria-labelledby="modalMessageLabel"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="modalMessageLabel">${data.identificador} - ${data.hora}</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              <div class="modal-body">
                  ${data.message}
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Aceptar</button>
              </div>
          </div>
      </div>
  </div>
  `);
  });

  socket.on("usersUpdate", function (data) {
    console.log("Nuevos clientes ", data);
  });
}

function home() {
  document.getElementById("tabla").style.visibility = "visible";
  document.getElementById("tablaHeader").style.visibility = "visible";
  document.getElementById("tableIDHistory").style.visibility = "collapse";
}
function historial() {
  document.getElementById("tabla").style.visibility = "collapse";
  document.getElementById("tablaHeader").style.visibility = "collapse";
  document.getElementById("tableIDHistory").style.visibility = "visible";
  let historial = JSON.parse(localStorage.getItem("getHistory"));
  $("#tbodyid").empty();
  historial.forEach((element) => {
    var table = document
      .getElementById("tableIDHistoryContent")
      .getElementsByTagName("tbody")[0];
    var row = table.insertRow(0);
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(0);
    var cell4 = row.insertCell(1);
    cell1.innerHTML = element.type;
    cell2.innerHTML = element.fecha;
    cell3.innerHTML = element.correo;
    cell4.innerHTML = element.identificador;
  });
}

function publicaHistorial(type, corre = undefined, identificado = undefined) {
  let correo = corre ? corre : document.getElementById("correo").value;
  let identificador = identificado
    ? identificado
    : document.getElementById("identificador").value;
  let historial = JSON.parse(localStorage.getItem("getHistory"));
  let validaId = document.getElementById("identificador").value;
  let validaMessage = document.getElementById("message").value;

  if (validaId) {
    let index = 0;
    let valida = true;
    malasPalabras.forEach((element) => {
      if (validaId.toLowerCase().includes(element.toLowerCase())) {
        valida = false;
        return false;
      }
      index++;
    });
    if(valida == false){
      alert("El titulo no puede incluir malas palabras!");
      return false;
    }
  }
  if (validaMessage) {
    let index = 0;
    let valida2 = true;
    malasPalabras.forEach((element) => {
      if (validaMessage.toLowerCase().includes(element.toLowerCase())) {
        valida2 = false;
        return false;
      }
      index++;
    });

    if(valida2 === false){
      alert("La publicación no puede incluir malas palabras!");
      return false;
    }
  }
  historial.push({
    type,
    identificador,
    correo,
    fecha:
      new Date().toISOString().split("T")[0] + " " +
      new Date().toISOString().split("T")[1].substring(0, 5),
  });
  localStorage.setItem("getHistory", JSON.stringify(historial));
  return true;
}
function darLike(id, value) {
  if(document.getElementById(`like${id}`).value > value){
    return
  }
  var xhr = new XMLHttpRequest();
  xhr.open("POST", "http://localhost:3000/darLike");
  xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhr.send(JSON.stringify({ id: id }));
  document.getElementById(`like${id}`).value =
    parseInt(document.getElementById(`like${id}`).value) + 1;
}
function dardislike(id, value) {
  if(document.getElementById(`like${id}`).value == 0){
    return
  }
  if(document.getElementById(`like${id}`).value <value){
    return
  }
  var xhr = new XMLHttpRequest();
  xhr.open("POST", "http://localhost:3000/darDisLike");
  xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhr.send(JSON.stringify({ id: id }));
  document.getElementById(`like${id}`).value =
    parseInt(document.getElementById(`like${id}`).value) - 1;
}


function formSubmit(type, corre = undefined, identificado = undefined){
  console.log('request');
  console.log('request');
  let correo = corre ? corre : document.getElementById("correo").value;
  let identificador = identificado
    ? identificado
    : document.getElementById("identificador").value;
  let historial = JSON.parse(localStorage.getItem("getHistory"));
  let validaId = document.getElementById("identificador").value;
  let validaMessage = document.getElementById("message").value;
  const hora = document.getElementById("hora").value
  const message = document.getElementById("message").value
  const name = document.getElementById("name").value

  if (validaId) {
    let index = 0;
    let valida = true;
    malasPalabras.forEach((element) => {
      if (validaId.toLowerCase().includes(element.toLowerCase())) {
        valida = false;
        return false;
      }
      index++;
    });
    if(valida == false){
      alert("El titulo no puede incluir malas palabras!");
      return false;
    }
  }
  if (validaMessage) {
    let index = 0;
    let valida2 = true;
    malasPalabras.forEach((element) => {
      if (validaMessage.toLowerCase().includes(element.toLowerCase())) {
        valida2 = false;
        return false;
      }
      index++;
    });

    if(valida2 === false){
      alert("La publicación no puede incluir malas palabras!");
      return false;
    }
  }
  historial.push({
    type,
    identificador,
    correo,
    fecha:
      new Date().toISOString().split("T")[0] + " " +
      new Date().toISOString().split("T")[1].substring(0, 5),
  });
  localStorage.setItem("getHistory", JSON.stringify(historial));
  var xhr = new XMLHttpRequest();
  console.log('request');
  xhr.onreadystatechange = async function() {
    if (xhr.readyState == XMLHttpRequest.DONE) {
      window.location.href='http://localhost:3000/menu'
      return false;
    }
}
  xhr.open("POST", "http://localhost:3000/crearPublicacion");
  xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhr.send(JSON.stringify({ hora: hora,correo: correo, message: message, identificador: identificador,
    name: name}));

}

function agregar(email) {
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = async function() {
    if (xhr.readyState == XMLHttpRequest.DONE) {
      window.location.href='http://localhost:3000/menu'
    }
}
  xhr.open("POST", "http://localhost:3000/agregarAmigo");
  xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhr.send(JSON.stringify({ email: email }));
}
function eliminar(email) {
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = async function() {
    if (xhr.readyState == XMLHttpRequest.DONE) {
      window.location.href='http://localhost:3000/menu'
    }
}
  xhr.open("POST", "http://localhost:3000/eliminarAmigo");
  xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhr.send(JSON.stringify({ email: email }));
}
function emitUserInformation() {
  socket.emit("userInformation", "respuesta");
}
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}
